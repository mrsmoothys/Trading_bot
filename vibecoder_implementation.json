{
  "context": {
    "project": "DeepSeek Dashboard Restoration",
    "last_update": "2025-11-19",
    "owner": "Codex via VibeCoder",
    "problem": "The UI rewrite stripped away most panels (trading controls, strategies, chat, telemetry) and callbacks. Current layout is a bare column that breaks functionality and looks outdated."
  },
  "plan": [
    {
      "id": "A1",
      "title": "Audit & Component Trace",
      "steps": [
        "Enumerate every component used in callbacks: inspect `ui/dashboard.py` (all `@callback` outputs) and cross-check `dashboard_elements.json`, `DASHBOARD_VERIFICATION_REPORT.md` to confirm required IDs (e.g., `positions-table`, `metrics-cards`, `trading-status-text`, `convergence-status`, `scalp-status`, `chat-history`, `backtest-modal`).",
        "Document which components currently exist in the DOM vs. missing, noting whether helper builders (e.g., `create_metrics_card`, `create_positions_table`) still exist."
      ],
      "acceptance": [
        "Spreadsheet/markdown list mapping callbacks → element IDs → present/missing status.",
        "No callback references an element that remains undefined."
      ]
    },
    {
      "id": "A2",
      "title": "Rebuild Layout Structure",
      "steps": [
        "Restore the previous section hierarchy in `layout()`: top nav (symbol/price/timeframe buttons, start/stop controls, alerts), overlay toggles with refresh/emergency buttons, metrics cards grid, main chart stack (price + volume + orderflow), positions table, system health, feature metrics, convergence strategy panel, scalp strategy panel, alert manager, trading control buttons, feature profile buttons, backtest modal launcher/results, DeepSeek chat (history + input + quick actions).",
        "Use `dbc.Container/Row/Col` or CSS Grid to create a two-column layout for desktop (`grid-template-columns: 2fr 1fr; gap: 24px`) that collapses to one column on tablets/mobile. Wrap each section in a card (`.ds-card`).",
        "Ensure all `dcc.Store`, `dcc.Interval`, modals, and hidden divs required by callbacks are reinstated."
      ],
      "acceptance": [
        "Every component listed in `dashboard_elements.json` renders with stable IDs.",
        "Layout adapts responsively between ≥1200px (two columns) and ≤992px (stacked)."
      ]
    },
    {
      "id": "A3",
      "title": "Reconnect Callbacks & Helpers",
      "steps": [
        "Verify each callback output returns valid children: reuse helper functions (`create_metrics_card`, `create_positions_table`, etc.) or add new ones for restored sections. Ensure buttons/stores (`refresh-btn`, `force-refresh-btn`, `setup-alerts-btn`, `chat-quick-*`) exist and have aria labels/tooltips.",
        "Re-add missing decorators (e.g., `@callback(Output('chat-send-button','disabled'), ...)`) that were removed in the rewrite.",
        "Confirm backtest promotion, alert setup, emergency stop, and feature profile toggles all point to the reinstated DOM nodes."
      ],
      "acceptance": [
        "Dash server logs show no `MissingCallbackContext` or `Cannot read property` errors on load.",
        "Interactions (start trading, toggle overlays, run convergence/scalp updates, chat send) behave as before."
      ]
    },
    {
      "id": "A4",
      "title": "Testing & Verification",
      "steps": [
        "Launch the dashboard (`python -m ui.dashboard`) and verify visually (Chrome MCP snapshot) that all sections render with the restored design.",
        "Add/update a smoke test (e.g., `tests/test_system_dashboard.py`) that calls `ui.dashboard.layout()` inside a Dash test app and asserts key IDs exist in the component tree.",
        "Run existing test suites (`pytest tests/test_backtest_service.py tests/test_scalp_15m_4h.py`, plus the new smoke test) and `make lint` if feasible."
      ],
      "acceptance": [
        "Dashboard screenshot shows fully populated UI.",
        "New smoke test passes, ensuring layout integrity.",
        "All pytest suites succeed."
      ]
    }
  ],
  "notes": [
    "Do not attempt stylistic polish until the functional layout is restored.",
    "Use existing CSS tokens/classes in `assets/custom.css` (e.g., `.ds-card`, `.text-tertiary`).",
    "Document any remaining UX polish tasks separately once functionality is back."
  ]
}
